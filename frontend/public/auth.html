<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In - Aslan Payment Infrastructure for AI Agents</title>
    <meta name="description" content="Sign in to AslanPay to manage your AI agent payment infrastructure. Get API keys, set spending limits, and monitor transactions.">
    
    <!-- Social Media Meta Tags -->
    <meta property="og:title" content="Sign In - Aslan Payment Infrastructure">
    <meta property="og:description" content="Sign in to AslanPay to manage your AI agent payment infrastructure. Get API keys, set spending limits, and monitor transactions.">
    <meta property="og:image" content="https://aslanpay.xyz/og-image.svg">
    <meta property="og:url" content="https://aslanpay.xyz/auth">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="AslanPay">
    
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Sign In - Aslan Payment Infrastructure">
    <meta name="twitter:description" content="Sign in to AslanPay to manage your AI agent payment infrastructure. Get API keys, set spending limits, and monitor transactions.">
    <meta name="twitter:image" content="https://aslanpay.xyz/og-image.svg">
    <meta name="twitter:creator" content="@aslanpay">
    
    <!-- Favicon and App Icons -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#FF6B35">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#FF6B35',
                        'primary-dark': '#E55A2B',
                        'secondary': '#F7931E',
                        'neutral-950': '#0A0A0A',
                        'neutral-900': '#1A1A1A',
                        'neutral-800': '#2A2A2A',
                        'neutral-700': '#3A3A3A',
                        'neutral-600': '#525252',
                        'neutral-500': '#737373',
                        'neutral-400': '#A3A3A3',
                        'neutral-300': '#D4D4D4',
                        'neutral-200': '#E5E5E5',
                        'neutral-100': '#F5F5F5',
                        'neutral-50': '#FAFAFA'
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
        }
        .glass-effect {
            backdrop-filter: blur(12px);
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .shadow-soft {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        .shadow-elegant {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }
        body {
            background: linear-gradient(135deg, #FAFAFA 0%, #F5F5F5 100%);
        }
    </style>
</head>
<body class="min-h-screen font-sans antialiased">
    <!-- Navigation -->
    <nav class="glass-effect border-b border-neutral-200/60">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <a href="/" class="text-neutral-900 font-bold text-xl tracking-tight">ASLAN</a>
                </div>
                <div class="flex items-center space-x-6">
                    <a href="/" class="text-neutral-600 hover:text-neutral-900 transition-colors text-sm font-medium">
                        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        Back to Home
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex items-center justify-center min-h-[calc(100vh-4rem)] py-12 px-6 lg:px-8">
        <div class="w-full max-w-md">
            <!-- Header -->
            <div class="text-center mb-8">
                <div class="w-16 h-16 gradient-bg rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-elegant">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                    </svg>
                </div>
                <h1 class="text-3xl lg:text-4xl font-bold text-neutral-900 mb-3">Welcome to Aslan</h1>
                <p class="text-neutral-600 text-lg">Payment infrastructure for AI agents</p>
            </div>

            <!-- Auth Container -->
            <div class="bg-white rounded-2xl shadow-elegant p-8">
                <!-- Tab Navigation -->
                <div class="flex bg-neutral-50 rounded-xl p-1 mb-8">
                    <button id="signin-tab" class="flex-1 py-3 px-4 text-sm font-semibold rounded-lg transition-colors bg-white text-neutral-900 shadow-soft">
                        Sign In
                    </button>
                    <button id="signup-tab" class="flex-1 py-3 px-4 text-sm font-semibold rounded-lg transition-colors text-neutral-600 hover:text-neutral-900">
                        Sign Up
                    </button>
                </div>

                <!-- Message Container -->
                <div id="message-container" class="mb-6"></div>

                <!-- Sign In Form -->
                <div id="signin-form">
                    <form id="login-form" class="space-y-6">
                        <div>
                            <label for="login-email" class="block text-sm font-semibold text-neutral-900 mb-2">Email address</label>
                            <input 
                                type="email" 
                                id="login-email" 
                                placeholder="you@company.com" 
                                required
                                class="w-full px-4 py-3 border border-neutral-300 rounded-xl text-neutral-900 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
                            >
                        </div>
                        
                        <div>
                            <label for="login-password" class="block text-sm font-semibold text-neutral-900 mb-2">Password</label>
                            <input 
                                type="password" 
                                id="login-password" 
                                placeholder="Enter your password" 
                                required
                                class="w-full px-4 py-3 border border-neutral-300 rounded-xl text-neutral-900 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
                            >
                        </div>

                        <button 
                            type="submit" 
                            id="login-btn"
                            class="w-full gradient-bg text-white py-3 px-4 rounded-xl font-semibold hover:opacity-90 transition-opacity shadow-elegant flex items-center justify-center"
                        >
                            <span id="login-text">Sign in to your account</span>
                            <div id="login-loading" class="hidden ml-2">
                                <svg class="animate-spin h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                            </div>
                        </button>
                    </form>

                    <div class="text-center mt-6">
                        <a href="#" id="forgot-password-link" class="text-primary hover:text-primary-dark transition-colors text-sm font-medium">
                            Forgot your password?
                        </a>
                    </div>

                    <div class="mt-6 p-4 bg-blue-50 rounded-xl border border-blue-200">
                        <p class="text-blue-800 text-sm">
                            <strong>New to Aslan?</strong> Sign up to get instant API keys and start processing payments for your AI agents in minutes.
                        </p>
                    </div>
                </div>

                <!-- Sign Up Form -->
                <div id="signup-form" class="hidden">
                    <form id="register-form" class="space-y-6">
                        <div>
                            <label for="register-name" class="block text-sm font-semibold text-neutral-900 mb-2">Full name</label>
                            <input 
                                type="text" 
                                id="register-name" 
                                placeholder="John Doe" 
                                required
                                class="w-full px-4 py-3 border border-neutral-300 rounded-xl text-neutral-900 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
                            >
                        </div>

                        <div>
                            <label for="register-email" class="block text-sm font-semibold text-neutral-900 mb-2">Email address</label>
                            <input 
                                type="email" 
                                id="register-email" 
                                placeholder="john@company.com" 
                                required
                                class="w-full px-4 py-3 border border-neutral-300 rounded-xl text-neutral-900 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
                            >
                        </div>
                        
                        <div>
                            <label for="register-password" class="block text-sm font-semibold text-neutral-900 mb-2">Password</label>
                            <input 
                                type="password" 
                                id="register-password" 
                                placeholder="Create a strong password" 
                                required 
                                minlength="8"
                                class="w-full px-4 py-3 border border-neutral-300 rounded-xl text-neutral-900 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
                            >
                            <p class="text-neutral-500 text-sm mt-2">Must be at least 8 characters long</p>
                        </div>

                        <div>
                            <label for="register-organization" class="block text-sm font-semibold text-neutral-900 mb-2">Organization name <span class="text-neutral-400 font-normal">(optional)</span></label>
                            <input 
                                type="text" 
                                id="register-organization" 
                                placeholder="Your Company" 
                                class="w-full px-4 py-3 border border-neutral-300 rounded-xl text-neutral-900 placeholder-neutral-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors"
                            >
                        </div>

                        <button 
                            type="submit" 
                            id="register-btn"
                            class="w-full gradient-bg text-white py-3 px-4 rounded-xl font-semibold hover:opacity-90 transition-opacity shadow-elegant flex items-center justify-center"
                        >
                            <span id="register-text">Create your account</span>
                            <div id="register-loading" class="hidden ml-2">
                                <svg class="animate-spin h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                            </div>
                        </button>
                    </form>

                    <div class="mt-6 p-4 bg-emerald-50 rounded-xl border border-emerald-200">
                        <p class="text-emerald-800 text-sm">
                            <strong>Get started instantly</strong> with our Sandbox plan - 750 free transactions per month to test your AI agents.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        const signinTab = document.getElementById('signin-tab');
        const signupTab = document.getElementById('signup-tab');
        const signinForm = document.getElementById('signin-form');
        const signupForm = document.getElementById('signup-form');

        function switchToSignin() {
            // Update tab styling
            signinTab.className = 'flex-1 py-3 px-4 text-sm font-semibold rounded-lg transition-colors bg-white text-neutral-900 shadow-soft';
            signupTab.className = 'flex-1 py-3 px-4 text-sm font-semibold rounded-lg transition-colors text-neutral-600 hover:text-neutral-900';
            
            // Show/hide forms
            signinForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
            hideMessage();
            resetLoadingStates();
        }

        function switchToSignup() {
            // Update tab styling
            signupTab.className = 'flex-1 py-3 px-4 text-sm font-semibold rounded-lg transition-colors bg-white text-neutral-900 shadow-soft';
            signinTab.className = 'flex-1 py-3 px-4 text-sm font-semibold rounded-lg transition-colors text-neutral-600 hover:text-neutral-900';
            
            // Show/hide forms
            signupForm.classList.remove('hidden');
            signinForm.classList.add('hidden');
            hideMessage();
            resetLoadingStates();
        }

        signinTab.addEventListener('click', switchToSignin);
        signupTab.addEventListener('click', switchToSignup);

        // Message management
        function showMessage(text, type = 'info') {
            const container = document.getElementById('message-container');
            let bgColor = 'bg-blue-50 border-blue-200 text-blue-800';
            
            if (type === 'success') {
                bgColor = 'bg-emerald-50 border-emerald-200 text-emerald-800';
            } else if (type === 'error') {
                bgColor = 'bg-red-50 border-red-200 text-red-800';
            }
            
            container.innerHTML = `
                <div class="p-4 rounded-xl border ${bgColor}">
                    <p class="text-sm">${text}</p>
                </div>
            `;
            container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function hideMessage() {
            const container = document.getElementById('message-container');
            container.innerHTML = '';
        }

        // Loading state management
        function setLoading(formType, loading) {
            const textEl = document.getElementById(`${formType}-text`);
            const loadingEl = document.getElementById(`${formType}-loading`);
            const btnEl = document.getElementById(`${formType}-btn`);
            
            if (loading) {
                textEl.textContent = 'Processing...';
                loadingEl.classList.remove('hidden');
                btnEl.disabled = true;
                btnEl.classList.add('opacity-75');
            } else {
                // Reset to original text
                textEl.textContent = formType === 'login' ? 'Sign in to your account' : 'Create your account';
                loadingEl.classList.add('hidden');
                btnEl.disabled = false;
                btnEl.classList.remove('opacity-75');
            }
        }

        function resetLoadingStates() {
            setLoading('login', false);
            setLoading('register', false);
        }

        // Enhanced error handling
        function handleApiError(response, data) {
            if (response.status === 409) {
                return 'An account with this email already exists. Try signing in instead.';
            } else if (response.status === 401) {
                return 'Invalid email or password. Please check your credentials.';
            } else if (response.status === 400) {
                return data.error || 'Please check your input and try again.';
            } else if (response.status >= 500) {
                return 'Server error. Please try again in a moment.';
            } else {
                return data.error || 'Something went wrong. Please try again.';
            }
        }

        // Login form handler
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showMessage('Please fill in all fields.', 'error');
                return;
            }
            
            setLoading('login', true);
            hideMessage();
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Store token in localStorage for API calls
                    if (data.token) {
                        localStorage.setItem('aslanpay_token', data.token);
                        console.log('✅ Token stored in localStorage');
                    }
                    
                    showMessage('✅ Login successful! Redirecting to your dashboard...', 'success');
                    setTimeout(() => {
                        window.location.href = '/dashboard.html';
                    }, 1500);
                } else {
                    const errorMessage = handleApiError(response, data);
                    showMessage(errorMessage, 'error');
                    setLoading('login', false); // Reset loading state on error
                }
            } catch (error) {
                console.error('Login error:', error);
                showMessage('Network error. Please check your connection and try again.', 'error');
                setLoading('login', false); // Reset loading state on error
            }
        });

        // Register form handler
        document.getElementById('register-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('register-name').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const organizationName = document.getElementById('register-organization').value.trim();
            
            if (!name || !email || !password) {
                showMessage('Please fill in all required fields.', 'error');
                return;
            }

            if (password.length < 8) {
                showMessage('Password must be at least 8 characters long.', 'error');
                return;
            }
            
            setLoading('register', true);
            hideMessage();
            
            try {
                const response = await fetch('/api/auth/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ 
                        name, 
                        email, 
                        password,
                        organizationName: organizationName || `${name}'s Organization`
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Store token in localStorage for API calls  
                    if (data.token) {
                        localStorage.setItem('aslanpay_token', data.token);
                        console.log('✅ Token stored in localStorage');
                    }
                    
                    showMessage('🎉 Account created successfully! You now have production-ready API keys. Redirecting...', 'success');
                    setTimeout(() => {
                        window.location.href = '/dashboard.html';
                    }, 2000);
                } else {
                    const errorMessage = handleApiError(response, data);
                    showMessage(errorMessage, 'error');
                    setLoading('register', false); // Reset loading state on error
                }
            } catch (error) {
                console.error('Registration error:', error);
                showMessage('Network error. Please check your connection and try again.', 'error');
                setLoading('register', false); // Reset loading state on error
            }
        });

        // Forgot password handler
        document.getElementById('forgot-password-link').addEventListener('click', (e) => {
            e.preventDefault();
            showMessage('Password reset feature is coming soon. Please contact support at support@aslanpay.xyz if you need assistance.', 'info');
        });

        // Auto-switch based on URL parameters
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const action = urlParams.get('action');
            
            if (action === 'signup') {
                switchToSignup();
            }

            // Auto-focus first input
            if (signinForm.classList.contains('hidden')) {
                document.getElementById('register-name').focus();
            } else {
                document.getElementById('login-email').focus();
            }
        });

        // Prevent form resubmission
        window.addEventListener('beforeunload', () => {
            resetLoadingStates();
        });
    </script>
</body>
</html> 